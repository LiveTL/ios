default_platform(:ios)

platform :ios do

  desc "Push a new release build to the App Store"
  lane :release do
    match(type: "development")
    cert
    sigh

    increment_build_number(xcodeproj: "ios.xcodeproj")

    disable_automatic_code_signing(path: "ios.xcodeproj")
    build_app(
      workspace: "ios.xcworkspace", 
      scheme: "ios",
      xcargs: {
        PROVISIONING_PROFILE_SPECIFIER: ENV["sigh_#{ENV['APP_IDENTIFIER']}_#{signing_type}"]
      }
    )
    enable_automatic_code_signing(path: "ios.xcodeproj")

    upload_to_testflight
  end
end
